{% extends 'base.html' %}

{% block title %}Confirmar Pedido - Mundo Cartas{% endblock %}

{% block page_header %}Confirmar Pedido{% endblock %}

{% block toolbar %}
<a href="{% url 'carrito:ver_carrito' %}" class="toolbar-btn">‚Üê Volver al Carrito</a>
<a href="{% url 'carrito:confirmar_pedido' %}" class="toolbar-btn active">‚úì Confirmar Pedido</a>
{% endblock %}

{% block content %}
<div style="padding: 20px; max-width: 1200px; margin: 0 auto;">
    <div class="section-title">CONFIRMACI√ìN DE PEDIDO</div>
    
    <div style="display: grid; grid-template-columns: 1fr 400px; gap: 30px;">
        <!-- Columna izquierda: Resumen de productos -->
        <div>
            <div style="background: white; border: 1px solid #d0d0d0; padding: 20px; margin-bottom: 20px;">
                <h3 style="font-size: 16px; font-weight: 700; color: #333; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #4472c4;">
                    üì¶ PRODUCTOS A COMPRAR
                </h3>
                
                {% for item in items %}
                <div style="display: grid; grid-template-columns: 60px 1fr auto; gap: 15px; padding: 15px 0; border-bottom: 1px solid #e0e0e0;">
                    <img src="{{ item.producto.get_imagen_url }}" 
                         alt="{{ item.producto.nombre }}"
                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; border: 1px solid #ddd;">
                    
                    <div>
                        <div style="font-weight: 600; color: #333; margin-bottom: 5px;">
                            {{ item.producto.nombre }}
                        </div>
                        <div style="font-size: 12px; color: #666;">
                            {{ item.producto.codigo_sku }} | {{ item.producto.categoria.nombre }}
                        </div>
                        <div style="font-size: 13px; color: #666; margin-top: 5px;">
                            Cantidad: <strong>{{ item.cantidad }}</strong> √ó ${{ item.producto.precio|floatformat:0 }}
                        </div>
                    </div>
                    
                    <div style="text-align: right;">
                        <div style="font-size: 18px; font-weight: 700; color: #28a745;">
                            ${{ item.subtotal|floatformat:0 }}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <!-- Informaci√≥n de retiro -->
            <div style="background: #e8f0ff; border: 1px solid #4472c4; padding: 20px; border-radius: 4px;">
                <h3 style="font-size: 14px; font-weight: 700; color: #2e5c8a; margin-bottom: 15px;">
                    üìç INFORMACI√ìN DE RETIRO
                </h3>
                <div style="font-size: 13px; color: #2e5c8a; line-height: 1.8;">
                    <p><strong>üè™ Retiro en tienda:</strong></p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>Los productos quedar√°n apartados a tu nombre</li>
                        <li>Direcci√≥n: <strong>Arica, Chile</strong> (ubicaci√≥n de la tienda)</li>
                        <li>Horario de retiro: Lunes a Viernes 10:00 - 19:00</li>
                        <li>Debes presentar tu comprobante de pago al retirar</li>
                        <li>Plazo m√°ximo de retiro: <strong>7 d√≠as h√°biles</strong></li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- Columna derecha: Resumen y pago -->
        <div>
            <div style="background: white; border: 2px solid #4472c4; padding: 25px; position: sticky; top: 20px;">
                <h3 style="font-size: 16px; font-weight: 700; color: #4472c4; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #4472c4; text-align: center;">
                    üßæ RESUMEN DEL PEDIDO
                </h3>
                
                <div style="margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 14px;">
                        <span style="color: #666;">Subtotal ({{ items.count }} productos):</span>
                        <span style="font-weight: 600;">${{ total|floatformat:0 }}</span>
                    </div>
                    
                    <div style="background: #f8f8f8; padding: 10px; border-radius: 4px; margin-bottom: 10px;">
                        <div style="font-size: 11px; color: #666; margin-bottom: 8px; text-align: center;">
                            <strong>Desglose de IVA (19%)</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 12px; color: #666; margin-bottom: 5px;">
                            <span>Neto (sin IVA):</span>
                            <span>${{ neto|floatformat:0 }}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 12px; color: #666;">
                            <span>IVA (19%):</span>
                            <span>${{ iva|floatformat:0 }}</span>
                        </div>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; font-size: 14px; color: #28a745; font-weight: 600;">
                        <span>Retiro en tienda:</span>
                        <span>GRATIS</span>
                    </div>
                </div>
                
                <div style="border-top: 3px solid #4472c4; padding-top: 15px; margin-bottom: 25px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 18px; font-weight: 700; color: #333;">TOTAL A PAGAR:</span>
                        <span style="font-size: 32px; font-weight: 700; color: #4472c4;">
                            ${{ total|floatformat:0 }}
                        </span>
                    </div>
                </div>
                
                <!-- Bot√≥n de pago con Transbank -->
                <a href="{% url 'carrito:iniciar_pago' %}" class="btn btn-primary" style="width: 100%; text-align: center; text-decoration: none; display: block; padding: 15px; font-size: 16px; margin-bottom: 10px;">
                    üí≥ PAGAR CON WEBPAY
                </a>
                
                <a href="{% url 'carrito:ver_carrito' %}" class="btn btn-secondary" style="width: 100%; text-align: center; text-decoration: none; display: block;">
                    ‚Üê MODIFICAR CARRITO
                </a>
                
                <div style="margin-top: 20px; padding: 15px; background: #e8f0ff; border-radius: 4px; font-size: 11px; color: #2e5c8a; text-align: center;">
                    <strong>üîí Pago 100% seguro</strong><br>
                    Procesado por Transbank Webpay Plus
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}